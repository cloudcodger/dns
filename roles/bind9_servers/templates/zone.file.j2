{# This file uses tabs because dynamicly updated zone files contain them. #}
;
; Dynamically generated by Ansible on {{ inventory_hostname }}
;
; Local modifications will be overwritten by Ansible.
;
$TTL {{ bind9_servers_zone_default_ttl }}
@			IN SOA	{{ bind9_servers_zone_mname }} {{ bind9_servers_email_address }} (
				{{ zone_serial.stdout | default(ansible_date_time.epoch) }} ; serial
				{{ zone.refresh | default(bind9_servers_zone_default_refresh) }} ; refresh
				{{ zone.retry | default(bind9_servers_zone_default_retry) }} ; retry
				{{ zone.expire | default(bind9_servers_zone_default_expire) }} ; expire
				{{ zone.negative_cache_ttl | default(bind9_servers_zone_default_negative_cache_ttl) }} ; minimum
				)

{# Create NS records for the name servers. #}
{% for ns in zone.ns | default(ansible_play_batch | sort) %}
			NS	{{ ns }}{{ ('.' + bind9_servers_domain_name + '.') if not ns is search("\.") }}
{% endfor %}

{# Create all records from the resource records variable for the zone. #}
{% if zone.records_var is defined and vars[zone.records_var] is defined %}
{%   for rr in vars[zone.records_var] %}
{%     set line=rr.split(';') %}
{#          line[0] = label #}
{#          line[1] = TTL #}
{#          line[2] = type #}
{#          line[3] = rdata #}
{%     set nl=line[0] | length %}
{%     if line[2] is defined %}
{{ line[0] }}{{ "\t" if nl < 16 }}{{ "\t" if nl < 8 }}{{ line[1] }}	{{ line[2] }}	{{ line[3] }}
{%     else %}

{%     endif %}
{%   endfor %}
{% endif %}
