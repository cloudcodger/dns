//
// Dynamically generated by Ansible on {{ inventory_hostname }}
//
// Local modifications will be overwritten by Ansible.
//

{% for zone in bind9_servers_zones %}
{%   if zone.allowed_tsig_keys is defined %}
include "/etc/bind/tsig.{{ zone.name }}";
{%   endif %}
zone "{{ zone.name }}." {
{%   if zone.forwarders is defined %}
    type forward;
    forwarders { {{ zone.forwarders | join('; ') }}; };
    forward only;
{%   elif zone.primaries is defined %}
    type secondary;
    file "local.db.{{ zone.name }}.bin";
    primaries { {{ zone.primaries | join('; ') }}; };
{%   else %}
    type primary;
    file "local.db.{{ zone.name }}";
{%     if zone.allowed_tsig_keys is defined %}
    allow-update {
{%       for name in zone.allowed_tsig_keys %}
        key {{ name }};
{%       endfor %}
    };
{%     endif %}
{%   endif %}
};

{% endfor %}
// Unused rfc1918 zones using db.empty
{% for zone in bind9_servers_rfc1918_empty_zones if zone not in bind9_servers_zones | map(attribute='name') %}
zone "{{ zone }}"  { type primary; file "/etc/bind/db.empty"; };
{% endfor %}
